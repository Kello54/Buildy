<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DIY Builder — Phase 3 (Merged)</title>
<!-- Fonts: keep same stack as earlier builds; replace with your exact font if needed -->
<style>
  :root{
    --gold: #b8860b;            /* your gold separators */
    --accent: #2e8b57;          /* subtle green for cheapest highlight */
    --bg-overlay: rgba(0,0,0,0.45);
    --card-bg: rgba(255,255,255,0.96);
    --muted: #6b7280;
    --max-width: 1150px;
    --radius: 8px;
  }
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{
    background-image: url('images/construction-bg.jpg'); /* change to your background image */
    background-size: cover;
    background-position: center;
    -webkit-font-smoothing:antialiased;
    color:#111;
  }

  /* HERO (keeps construction background but readable) */
  .hero-wrap{
    background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.32));
    padding: 22px 16px;
  }
  .hero {
    max-width: var(--max-width);
    margin: 0 auto;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .logo {
    display:flex;
    align-items:center;
    gap:12px;
  }
  .logo img{height:56px;border-radius:6px;background:rgba(255,255,255,0.08);padding:6px;}
  .brand-text h1{margin:0;font-size:22px;color:#fff;}
  .brand-text p{margin:0;color:rgba(255,255,255,0.9);font-size:13px;}

  /* sub-header row with gold separators between items only */
  .sub-header {
    margin-top:12px;
    display:flex;
    gap:12px;
    align-items:center;
    color:rgba(255,255,255,0.92);
    font-size:13px;
  }
  .sub-item { padding:8px 12px; display:flex; align-items:center; gap:8px; background: rgba(255,255,255,0.03); border-radius:999px; }
  /* gold separators: visually between each sub-item */
  .sub-item + .sub-item { position:relative; }
  .sub-item + .sub-item::before{
    content:'';
    position:absolute;
    left:-6px;
    top:50%;
    transform:translateY(-50%);
    width:12px;
    height:2px;
    background:var(--gold);
    border-radius:2px;
  }

  /* sticky controls (keeps quick search accessible) */
  .sticky-controls{
    position:sticky;
    top:8px;
    z-index:1200;
    margin: 12px auto 0;
    max-width:var(--max-width);
    padding:10px;
    pointer-events:auto;
  }

  /* app container */
  .app {
    max-width: var(--max-width);
    margin: 18px auto 80px;
    padding: 0 16px;
  }

  .card{
    background: var(--card-bg);
    border-radius: var(--radius);
    box-shadow: 0 8px 28px rgba(2,6,23,0.12);
    padding:14px;
    margin-bottom:14px;
    overflow:visible;
  }

  /* controls */
  .controls{
    display:flex;
    gap:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .search {
    flex:1 1 380px;
    display:flex;
    gap:8px;
    align-items:center;
  }
  .search input{
    flex:1;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid #e6e6e8;
    font-size:14px;
  }
  .filters{ display:flex; gap:8px; flex-wrap:wrap; }
  .filters button{
    padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.06); background:white; font-size:13px; cursor:pointer;
  }
  .filters button.active{ border-color:var(--gold); box-shadow:0 4px 14px rgba(184,134,11,0.06); }

  /* accordion / category */
  .accordion{ margin-top:12px; }
  .category{ margin-bottom:10px; border-radius:8px; overflow:hidden; border:1px solid rgba(0,0,0,0.05); }
  .category-header{
    display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:linear-gradient(180deg,#fff,#fbfbfb);cursor:pointer;
  }
  .category-header h3{margin:0;font-size:15px;color:#111;}
  .category-header .meta{ font-size:13px;color:var(--muted); }
  .category-body{ padding:12px 14px; border-top:1px solid rgba(0,0,0,0.04); display:none; background:linear-gradient(transparent, rgba(255,255,255,0.4)); }

  /* product table (clean, no gold separators) */
  table{ width:100%; border-collapse:collapse; font-size:14px; }
  th,td{ padding:10px 8px; text-align:left; border-bottom:1px dashed rgba(0,0,0,0.06); vertical-align:middle; }
  th{ font-weight:700; font-size:13px; color:var(--muted); }
  .prod-name{ min-width:180px; font-weight:700; }
  .supplier-cell{ min-width:140px; vertical-align:top; }
  .cheapest{ background: linear-gradient(90deg, rgba(46,139,87,0.08), transparent); border-radius:6px; }

  .supplier-meta{ display:flex; align-items:center; gap:8px; }
  .supplier-meta img{ height:28px; width:28px; object-fit:contain; border-radius:6px; background:#fff; padding:4px; border:1px solid rgba(0,0,0,0.04); }

  .actions { display:flex; gap:8px; align-items:center; }
  .btn{ padding:8px 10px; border-radius:8px; border:0; cursor:pointer; font-weight:700; }
  .btn-outline{ background:transparent; border:1px solid rgba(0,0,0,0.08); }
  .btn-gold{ background:var(--gold); color:white; }
  .btn-green{ background:var(--accent); color:white; }

  /* floating cart/wishlist & back-to-top */
  .floating {
    position:fixed; right:16px; bottom:16px; z-index:1400; display:flex; flex-direction:column; gap:10px;
  }
  .floating button{ background: rgba(255,255,255,0.96); padding:10px 12px; border-radius:999px; border:0; box-shadow:0 8px 28px rgba(2,6,23,0.12); font-weight:700; cursor:pointer; display:flex; gap:10px; align-items:center;}
  .count-badge{ background:var(--gold); color:white; padding:6px 8px; border-radius:999px; font-weight:800; }

  /* cart preview */
  #cartPreview { margin-top:10px; }
  .cart-row{ display:flex; justify-content:space-between; gap:12px; padding:8px 0; border-bottom:1px dashed rgba(0,0,0,0.06); }
  .cart-total{ display:flex; justify-content:space-between; font-weight:800; padding-top:8px; }

  /* back to top */
  #backTop { position:fixed; left:16px; bottom:16px; z-index:1400; background:rgba(255,255,255,0.98); padding:10px 12px; border-radius:999px; box-shadow:0 8px 28px rgba(2,6,23,0.12); display:none; cursor:pointer; }

  /* responsive */
  @media (max-width:900px){
    .hero { flex-direction:column; align-items:flex-start; gap:10px; }
    .logo img{ height:48px; }
    .sub-header{ flex-wrap:wrap; gap:8px; }
    .sticky-controls{ top:6px; }
  }
  @media (max-width:600px){
    th,td{ font-size:13px; padding:8px 6px; }
    .supplier-cell{ min-width:120px; }
    .search input{ padding:9px; }
  }
</style>
</head>
<body>
  <!-- HERO -->
  <div class="hero-wrap" role="banner" aria-label="Hero">
    <div class="hero">
      <div style="display:flex;flex-direction:column;gap:8px;">
        <div style="display:flex;align-items:center;gap:12px;">
          <div class="logo">
            <img src="images/logo-placeholder.png" alt="DIY Builder logo" />
            <div class="brand-text">
              <h1>DIY Builder</h1>
              <p style="color:var(--gold);font-weight:700;">Your project, your price — compare & save</p>
            </div>
          </div>
        </div>

        <!-- sub header with gold separators between items only -->
        <div class="sub-header" aria-hidden="false">
          <div class="sub-item">Project: <strong style="margin-left:6px">Home Extension</strong></div>
          <div class="sub-item">Location: <strong style="margin-left:6px">Ireland</strong></div>
          <div class="sub-item">Suppliers: <strong style="margin-left:6px">Chadwicks • Woodies • Buckley</strong></div>
          <div class="sub-item">Mode: <strong style="margin-left:6px">Comparison</strong></div>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px;">
        <div style="display:flex;gap:10px;align-items:center;">
          <a href="#" style="color:white;text-decoration:none;font-weight:700;background:rgba(0,0,0,0.24);padding:8px 12px;border-radius:8px;">Login</a>
        </div>
        <div style="color:rgba(255,255,255,0.9);font-size:13px;text-align:right;">
          <div>Phase 3 — merged with your Phase 2 styling</div>
          <div class="small" style="opacity:0.9">Gold separators kept in sub-header only</div>
        </div>
      </div>
    </div>
  </div>

  <!-- sticky controls containing quick search & filters -->
  <div class="sticky-controls">
    <div class="card" role="region" aria-label="Search and filters" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <div class="controls" style="flex:1;">
        <div class="search" role="search" aria-label="Search products">
          <input id="searchInput" placeholder="Search products, brand, or SKU..." aria-label="Search products" />
          <button id="clearSearch" class="btn btn-outline">Clear</button>
        </div>
        <div class="filters" role="toolbar" aria-label="Category filters">
          <button class="filter-btn active" data-cat="all">All</button>
          <button class="filter-btn" data-cat="timber">Timber</button>
          <button class="filter-btn" data-cat="cement">Cement & Aggregates</button>
          <button class="filter-btn" data-cat="paint">Paint & Finishes</button>
          <button class="filter-btn" data-cat="tools">Tools & Fixings</button>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <div style="font-size:13px;color:var(--muted);">Quick actions</div>
        <button id="exportAll" class="btn btn-outline" title="Export sample CSV">Export CSV</button>
      </div>
    </div>
  </div>

  <main class="app" role="main">
    <!-- Product list / comparisons -->
    <section class="card" aria-label="Product price comparison">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h2 style="margin:0;font-size:16px;">Products & Price Comparison</h2>
        <div class="small" style="color:var(--muted);">Click category to expand. Cheapest is subtly highlighted.</div>
      </div>

      <div id="accordionRoot" class="accordion" aria-live="polite" style="margin-top:12px;">
        <!-- categories render here -->
      </div>
    </section>

    <!-- Saved & cart -->
    <section class="card" aria-label="Saved items and Cart">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
        <div>
          <h3 style="margin:0 0 6px 0">Saved / Quick Cart</h3>
          <div style="color:var(--muted);font-size:13px;">You have <strong id="wishlistCount">0</strong> saved and <strong id="cartCount">0</strong> in cart.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="viewCart" class="btn btn-gold">View Cart</button>
          <button id="clearAll" class="btn btn-outline">Clear All</button>
        </div>
      </div>

      <div id="cartPreview" style="margin-top:12px;display:none;"></div>
    </section>
  </main>

  <!-- floating buttons -->
  <div class="floating" aria-hidden="false">
    <button id="goWishlist">♥ Saved <span id="wishBadge" class="count-badge">0</span></button>
    <button id="goCart">🛒 Cart <span id="cartBadge" class="count-badge">0</span></button>
  </div>

  <button id="backTop" title="Back to top">↑ Top</button>

  <footer style="max-width:var(--max-width);margin:18px auto 40px;padding:0 16px;color:var(--muted);font-size:13px;">
    Tip: swap logos and supplier links in the `suppliers` array inside the script.
  </footer>

<script>
/* -------------------------------
   SAMPLE DATA — replace with your Phase 2 full dataset as needed
   ------------------------------- */
const suppliers = [
  { id:'chadwicks', name:'Chadwicks', phone:'+35312345601', website:'https://chadwicks.example', logo:'images/chadwicks.png' },
  { id:'woodies', name:'Woodies', phone:'+35312345602', website:'https://woodies.example', logo:'images/woodies.png' },
  { id:'buckley', name:'Buckley', phone:'+35312345603', website:'https://buckley.example', logo:'images/buckley.png' }
];

const products = [
  { id:'t1', name:'Pressure Treated 2x4 Timber (3m)', cat:'timber', sku:'T-2X4-3M', prices:{ chadwicks:19.49, woodies:20.10, buckley:18.95 }},
  { id:'t2', name:'Plywood 12mm (2440x1220)', cat:'timber', sku:'PLY-12-2440', prices:{ chadwicks:35.90, woodies:34.75, buckley:36.00 }},
  { id:'c1', name:'Portland Cement 25kg', cat:'cement', sku:'CEM-25', prices:{ chadwicks:8.50, woodies:8.95, buckley:8.30 }},
  { id:'c2', name:'Sharp Sand (per tonne)', cat:'cement', sku:'SAND-1T', prices:{ chadwicks:42.00, woodies:40.50, buckley:41.20 }},
  { id:'p1', name:'Exterior Masonry Paint 10L', cat:'paint', sku:'PAINT-MEX-10', prices:{ chadwicks:79.99, woodies:75.50, buckley:78.00 }},
  { id:'p2', name:'Primer Undercoat 5L', cat:'paint', sku:'PRIM-5L', prices:{ chadwicks:32.50, woodies:30.99, buckley:31.49 }},
  { id:'s1', name:'50mm Timber Screws (Box 200)', cat:'tools', sku:'SCREW-50-200', prices:{ chadwicks:14.99, woodies:15.50, buckley:13.95 }},
  { id:'s2', name:'Cordless Drill (18V)', cat:'tools', sku:'DRILL-18V', prices:{ chadwicks:89.99, woodies:85.00, buckley:92.00 }},
];

/* -------------------------------
   Local storage keys
   ------------------------------- */
const LS_CART = 'phase3_merged_cart_v1';
const LS_WISH = 'phase3_merged_wish_v1';
function loadCart(){ try{ return JSON.parse(localStorage.getItem(LS_CART))||{} }catch(e){return{}} }
function loadWish(){ try{ return JSON.parse(localStorage.getItem(LS_WISH))||{} }catch(e){return{}} }
function saveCart(obj){ localStorage.setItem(LS_CART, JSON.stringify(obj)) }
function saveWish(obj){ localStorage.setItem(LS_WISH, JSON.stringify(obj)) }

let cart = loadCart();
let wish = loadWish();

/* -------------------------------
   Render categories & tables (keeps Phase2 look)
   ------------------------------- */
const accordionRoot = document.getElementById('accordionRoot');

function groupByCategory(items){
  const m = {};
  items.forEach(p => { if(!m[p.cat]) m[p.cat]=[]; m[p.cat].push(p); });
  return m;
}

function renderCategories(filter='all', q=''){
  accordionRoot.innerHTML='';
  const grouped = groupByCategory(products);
  const order = ['timber','cement','paint','tools'];
  const names = { timber:'Timber', cement:'Cement & Aggregates', paint:'Paint & Finishes', tools:'Tools & Fixings' };

  order.forEach(cat=>{
    if(filter !== 'all' && filter !== cat) return;
    const list = (grouped[cat] || []).filter(p => {
      if(!q) return true;
      const s = q.toLowerCase();
      return (p.name||'').toLowerCase().includes(s) || (p.sku||'').toLowerCase().includes(s);
    });
    if(!list.length) return;

    const catEl = document.createElement('div'); catEl.className='category';
    const header = document.createElement('div'); header.className='category-header'; header.setAttribute('role','button'); header.setAttribute('aria-expanded','false');
    header.innerHTML = \`
      <div>
        <h3>\${names[cat] || cat}</h3>
        <div class="meta">\${list.length} item(s)</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px"><div class="small">Tap to expand</div><div style="font-size:18px;transform:rotate(90deg)">❯</div></div>
    \`;
    const body = document.createElement('div'); body.className='category-body'; body.style.display='none';
    body.appendChild(renderTable(list));
    header.addEventListener('click', () => {
      const expanded = header.getAttribute('aria-expanded') === 'true';
      header.setAttribute('aria-expanded', String(!expanded));
      body.style.display = expanded ? 'none' : 'block';
    });

    catEl.appendChild(header);
    catEl.appendChild(body);
    accordionRoot.appendChild(catEl);
  });
}

/* builds table: clean look, cheapest highlight uses subtle green bg */
function renderTable(list){
  const wrapper = document.createElement('div'); wrapper.style.overflowX='auto';
  const table = document.createElement('table');
  const thead = document.createElement('thead');
  thead.innerHTML = '<tr><th>Product</th><th>SKU</th>'+ suppliers.map(s=>'<th>'+s.name+'</th>').join('') +'<th>Actions</th></tr>';
  table.appendChild(thead);
  const tbody = document.createElement('tbody');

  list.forEach(prod=>{
    const row = document.createElement('tr');
    const entries = suppliers.map(s => ({ id:s.id, price: prod.prices[s.id] ?? null }));
    const valid = entries.filter(e => e.price !== null && !Number.isNaN(e.price));
    const min = valid.length ? Math.min(...valid.map(e=>e.price)) : null;

    // name
    const tdName = document.createElement('td'); tdName.className='prod-name'; tdName.innerHTML = '<div>'+prod.name+'</div><div class="small" style="color:var(--muted)">'+prod.cat+'</div>';
    row.appendChild(tdName);

    const tdSku = document.createElement('td'); tdSku.textContent = prod.sku || '-'; tdSku.className='small'; row.appendChild(tdSku);

    suppliers.forEach(s=>{
      const td = document.createElement('td'); td.className='supplier-cell';
      const price = prod.prices[s.id];
      if(price === undefined || price === null){
        td.innerHTML = '<div class="small">—</div>';
      } else {
        const cheapestClass = (min !== null && price === min) ? 'cheapest' : '';
        td.innerHTML = \`
          <div class="\${cheapestClass}" style="padding:6px;border-radius:6px;display:flex;justify-content:space-between;align-items:center">
            <div style="display:flex;gap:8px;align-items:center;">
              <img src="\${s.logo}" alt="\${s.name} logo" onerror="this.style.display='none'"/>
              <div>
                <div style="font-weight:800">€\${price.toFixed(2)}</div>
                <div class="small" style="color:var(--muted)">per unit</div>
              </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
              <a href="tel:\${s.phone}" class="small" title="Call \${s.name}">Call</a>
              <a href="\${s.website}" target="_blank" rel="noopener" class="small">Visit</a>
            </div>
          </div>
        \`;
      }
      row.appendChild(td);
    });

    // actions
    const actionTd = document.createElement('td'); actionTd.style.minWidth='160px';
    const addBtn = document.createElement('button'); addBtn.className='btn btn-outline'; addBtn.textContent='Add to Cart';
    addBtn.addEventListener('click', ()=> addToCart(prod.id));
    const wishBtn = document.createElement('button'); wishBtn.className='btn'; wishBtn.textContent = wish[prod.id] ? 'Saved' : 'Save';
    wishBtn.addEventListener('click', ()=> { toggleWish(prod.id); wishBtn.textContent = wish[prod.id] ? 'Saved' : 'Save'; });
    actionTd.appendChild(addBtn); actionTd.appendChild(wishBtn);
    row.appendChild(actionTd);

    tbody.appendChild(row);
  });

  table.appendChild(tbody); wrapper.appendChild(table);
  return wrapper;
}

/* -------------------------------
   Cart & wishlist helpers
   ------------------------------- */
function addToCart(prodId){
  cart[prodId] = (cart[prodId] || 0) + 1;
  saveCart(cart);
  updateBadges();
  renderCartPreview();
  toast('Added to cart');
}

function toggleWish(prodId){
  if(wish[prodId]) delete wish[prodId]; else wish[prodId] = { savedAt: Date.now() };
  saveWish(wish);
  updateBadges();
  renderCartPreview();
}

function updateBadges(){
  const wishCount = Object.keys(wish).length;
  const cartCount = Object.values(cart).reduce((a,b)=>a+b,0);
  document.getElementById('wishBadge').textContent = wishCount;
  document.getElementById('cartBadge').textContent = cartCount;
  document.getElementById('wishlistCount').textContent = wishCount;
  document.getElementById('cartCount').textContent = cartCount;
}

/* cart preview + running total */
function renderCartPreview(){
  const el = document.getElementById('cartPreview');
  el.innerHTML = '';
  const keys = Object.keys(cart);
  if(keys.length === 0 && Object.keys(wish).length === 0){
    el.innerHTML = '<div class="small" style="color:var(--muted)">No saved items or cart items yet.</div>';
    return;
  }
  if(keys.length){
    const title = document.createElement('div'); title.innerHTML = '<strong>Cart</strong>'; el.appendChild(title);
    let total = 0;
    keys.forEach(pid=>{
      const prod = products.find(p=>p.id===pid);
      if(!prod) return;
      const qty = cart[pid];
      // price = cheapest by default
      let chosen = { price: Infinity, supplier: '' };
      suppliers.forEach(s=>{
        const p = prod.prices[s.id];
        if(typeof p === 'number' && p < chosen.price){ chosen.price = p; chosen.supplier = s.name; }
      });
      if(!isFinite(chosen.price)) chosen.price = 0;
      total += chosen.price * qty;
      const row = document.createElement('div'); row.className='cart-row';
      row.innerHTML = \`<div>\${prod.name} <div class="small" style="color:var(--muted)">x\${qty} • \${chosen.supplier}</div></div><div>€\${(chosen.price*qty).toFixed(2)}</div>\`;
      el.appendChild(row);
    });
    const tot = document.createElement('div'); tot.className='cart-total'; tot.innerHTML = '<div>Total</div><div>€'+total.toFixed(2)+'</div>';
    el.appendChild(tot);
    const actions = document.createElement('div'); actions.style.marginTop='8px'; actions.innerHTML = '<button id="exportCart" class="btn btn-gold">Export Cart (CSV)</button> <button id="emptyCart" class="btn btn-outline">Empty Cart</button>';
    el.appendChild(actions);
    document.getElementById('exportCart').addEventListener('click', exportCartCSV);
    document.getElementById('emptyCart').addEventListener('click', ()=>{ if(confirm('Empty cart?')){ cart={}; saveCart(cart); updateBadges(); renderCartPreview(); } });
  }

  const wishKeys = Object.keys(wish);
  if(wishKeys.length){
    const title = document.createElement('div'); title.innerHTML = '<strong style="margin-top:8px;display:block">Saved</strong>'; el.appendChild(title);
    wishKeys.forEach(pid=>{
      const prod = products.find(p=>p.id===pid);
      if(!prod) return;
      const row = document.createElement('div'); row.className='cart-row';
      row.innerHTML = \`<div>\${prod.name}</div><div><button class="btn btn-outline" data-id="\${pid}" onclick="addFromPreview('\${pid}')">Add</button></div>\`;
      el.appendChild(row);
    });
  }
}

/* add from preview (global) */
window.addFromPreview = function(pid){ addToCart(pid); }

/* export cart CSV */
function exportCartCSV(){
  const rows = [['SKU','Product','Qty','UnitPriceEUR','Supplier']];
  Object.keys(cart).forEach(pid=>{
    const prod = products.find(p=>p.id===pid);
    if(!prod) return;
    let chosenSupplier = ''; let chosenPrice = 0;
    suppliers.forEach(s=>{ const p = prod.prices[s.id]; if(typeof p === 'number' && (chosenSupplier === '' || p < chosenPrice)){ chosenPrice = p; chosenSupplier = s.name; } });
    rows.push([prod.sku||'', prod.name, cart[pid], chosenPrice.toFixed(2), chosenSupplier]);
  });
  const csv = rows.map(r => r.map(c => '\"'+String(c).replace(/\"/g,'\"\"')+'\"').join(',')).join('\\n');
  const blob = new Blob([csv], { type: 'text/csv' }); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'cart_export.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

/* toast */
let toastTimer = null;
function toast(msg){
  const t = document.createElement('div'); t.textContent = msg;
  t.style.position='fixed'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.bottom='24px'; t.style.padding='10px 16px';
  t.style.background='rgba(0,0,0,0.8)'; t.style.color='white'; t.style.borderRadius='999px'; t.style.zIndex=3000;
  document.body.appendChild(t); clearTimeout(toastTimer); toastTimer=setTimeout(()=>t.remove(),1800);
}

/* -------------------------------
   Event bindings: filters, search, floating buttons
   ------------------------------- */
document.querySelectorAll('.filter-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const cat = btn.getAttribute('data-cat');
    const q = document.getElementById('searchInput').value.trim();
    renderCategories(cat, q);
  });
});

document.getElementById('searchInput').addEventListener('input', (e)=>{
  const q = e.target.value.trim();
  const active = document.querySelector('.filter-btn.active')?.getAttribute('data-cat') || 'all';
  renderCategories(active, q);
});
document.getElementById('clearSearch').addEventListener('click', ()=>{ document.getElementById('searchInput').value=''; renderCategories('all',''); });

document.getElementById('goWishlist').addEventListener('click', ()=>{ document.querySelector('.filter-btn[data-cat="all"]').click(); toast('Opened wishlist section — scroll down.'); });
document.getElementById('goCart').addEventListener('click', ()=>{ document.getElementById('viewCart').click(); toast('Opened cart preview.'); });

document.getElementById('viewCart').addEventListener('click', ()=>{
  const el = document.getElementById('cartPreview'); el.style.display = el.style.display==='block' ? 'none' : 'block';
});

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(confirm('Clear cart and saved items?')){ cart={}; wish={}; saveCart(cart); saveWish(wish); updateBadges(); renderCartPreview(); }
});

/* exportAll sample action (can be linked to your full product CSV export) */
document.getElementById('exportAll').addEventListener('click', ()=>{
  // quick CSV of product list (sample)
  const rows = [['SKU','Product','Category','Chadwicks','Woodies','Buckley']];
  products.forEach(p => rows.push([p.sku||'', p.name, p.cat, p.prices.chadwicks||'', p.prices.woodies||'', p.prices.buckley||'']));
  const csv = rows.map(r => r.map(c=>'\"'+String(c).replace(/\"/g,'\"\"')+'\"').join(',')).join('\\n');
  const blob = new Blob([csv], { type: 'text/csv' }); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'products_export.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  toast('Exported product CSV (sample).');
});

/* back-to-top */
const backBtn = document.getElementById('backTop');
window.addEventListener('scroll', ()=> {
  if(window.scrollY > 400) backBtn.style.display='block'; else backBtn.style.display='none';
});
backBtn.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}) );

/* -------------------------------
   Init
   ------------------------------- */
(function init(){
  renderCategories('all','');
  updateBadges();
  renderCartPreview();
  // expand first category by default for accessibility
  const firstHeader = document.querySelector('.category .category-header'); if(firstHeader) firstHeader.click();
})();
</script>
</body>
</html>
