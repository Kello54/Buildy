<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buildy - Building Material Price Comparison</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f7f7f7;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #4b0082;
  }
  .form-container, .filter-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-bottom: 15px;
  }
  input, button, select {
    padding: 8px;
    font-size: 1rem;
  }
  button {
    background: #4b0082;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background: #6a0dad;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    overflow-x: auto;
    display: block;
  }
  th, td {
    padding: 10px;
    text-align: center;
    border: 1px solid #ccc;
    min-width: 100px;
  }
  th {
    background: #4b0082;
    color: white;
    cursor: pointer;
  }
  td.cheapest {
    background: #c6f5c6;
    font-weight: bold;
  }
  td.total {
    font-weight: bold;
    background: #e6e6fa;
  }
  @media(max-width: 600px) {
    th, td {
      font-size: 0.85rem;
      min-width: 80px;
    }
    .form-container, .filter-container {
      flex-direction: column;
      align-items: stretch;
    }
  }
</style>
</head>
<body>

<h1>Buildy - Building Material Price Comparison</h1>

<div class="form-container">
  <input type="text" id="materialName" placeholder="Material Name">
  <input type="text" id="supplierName" placeholder="Supplier Name">
  <input type="number" id="price" placeholder="Price" step="0.01">
  <button onclick="addPrice()">Add Price</button>
</div>

<div class="filter-container">
  <input type="text" id="filterMaterial" placeholder="Filter by Material" oninput="renderTable()">
  <select id="filterSupplier" onchange="renderTable()">
    <option value="">All Suppliers</option>
  </select>
</div>

<table id="priceTable">
  <thead>
    <tr id="tableHeader">
      <th onclick="sortBy('material')">Material ðŸ”½</th>
      <!-- Supplier columns generated dynamically -->
      <th>Cheapest</th>
    </tr>
  </thead>
  <tbody>
    <!-- Rows generated dynamically -->
  </tbody>
  <tfoot>
    <tr id="totalRow">
      <!-- Total row generated dynamically -->
    </tr>
  </tfoot>
</table>

<script>
let materials = [];
let suppliersSet = new Set();
let sortDirection = { material: 'asc' };

function addPrice() {
  const material = document.getElementById('materialName').value.trim();
  const supplier = document.getElementById('supplierName').value.trim();
  const price = parseFloat(document.getElementById('price').value);

  if (!material || !supplier || isNaN(price)) {
    alert("Please fill all fields correctly!");
    return;
  }

  suppliersSet.add(supplier);
  updateSupplierFilter();

  let mat = materials.find(m => m.name.toLowerCase() === material.toLowerCase());
  if (!mat) {
    mat = { name: material, prices: [] };
    materials.push(mat);
  }

  const existingPrice = mat.prices.find(p => p.supplier.toLowerCase() === supplier.toLowerCase());
  if (existingPrice) {
    existingPrice.price = price;
  } else {
    mat.prices.push({ supplier, price });
  }

  document.getElementById('materialName').value = '';
  document.getElementById('supplierName').value = '';
  document.getElementById('price').value = '';

  renderTable();
}

function updateSupplierFilter() {
  const select = document.getElementById('filterSupplier');
  const currentOptions = Array.from(select.options).map(opt => opt.value);
  suppliersSet.forEach(s => {
    if (!currentOptions.includes(s)) {
      const option = document.createElement('option');
      option.value = s;
      option.textContent = s;
      select.appendChild(option);
    }
  });
}

function renderTable() {
  const tbody = document.querySelector('#priceTable tbody');
  tbody.innerHTML = '';

  const filterMat = document.getElementById('filterMaterial').value.toLowerCase();
  const filterSup = document.getElementById('filterSupplier').value;

  const headerRow = document.getElementById('tableHeader');
  headerRow.innerHTML = '<th onclick="sortBy(\'material\')">Material ðŸ”½</th>';

  const suppliers = Array.from(suppliersSet);
  suppliers.forEach(s => {
    const th = document.createElement('th');
    th.textContent = s;
    headerRow.appendChild(th);
  });
  const cheapestTh = document.createElement('th');
  cheapestTh.textContent = 'Cheapest';
  headerRow.appendChild(cheapestTh);

  let filteredMaterials = materials.filter(m => m.name.toLowerCase().includes(filterMat));

  filteredMaterials.forEach(mat => {
    const row = document.createElement('tr');
    const nameCell = document.createElement('td');
    nameCell.textContent = mat.name;
    row.appendChild(nameCell);

    let cheapestPrice = Infinity;
    let cheapestSupplier = '';
    let totalPrice = 0;

    suppliers.forEach(s => {
      const cell = document.createElement('td');
      const priceObj = mat.prices.find(p => p.supplier.toLowerCase() === s.toLowerCase());
      if (priceObj) {
        if (!filterSup || filterSup === s) cell.textContent = `â‚¬${priceObj.price.toFixed(2)}`;
        if (priceObj.price < cheapestPrice) {
          cheapestPrice = priceObj.price;
          cheapestSupplier = s;
        }
        totalPrice += priceObj.price;
      } else {
        if (!filterSup || filterSup === s) cell.textContent = '-';
      }
      row.appendChild(cell);
    });

    const cheapestCell = document.createElement('td');
    cheapestCell.textContent = cheapestSupplier || '-';
    if (cheapestSupplier) cheapestCell.classList.add('cheapest');
    row.appendChild(cheapestCell);

    tbody.appendChild(row);
  });

  renderTotals(filteredMaterials, suppliers);
}

function renderTotals(materialsList, suppliers) {
  const tfoot = document.getElementById('totalRow');
  tfoot.innerHTML = '';

  const totalLabel = document.createElement('td');
  totalLabel.textContent = 'Total';
  totalLabel.classList.add('total');
  tfoot.appendChild(totalLabel);

  suppliers.forEach(s => {
    const totalCell = document.createElement('td');
    let sum = 0;
    materialsList.forEach(m => {
      const priceObj = m.prices.find(p => p.supplier.toLowerCase() === s.toLowerCase());
      if (priceObj) sum += priceObj.price;
    });
    totalCell.textContent = `â‚¬${sum.toFixed(2)}`;
    totalCell.classList.add('total');
    tfoot.appendChild(totalCell);
  });

  const emptyCell = document.createElement('td');
  emptyCell.textContent = '-';
  emptyCell.classList.add('total');
  tfoot.appendChild(emptyCell);
}

function sortBy(column) {
  if (column === 'material') {
    materials.sort((a, b) => {
      if (sortDirection.material === 'asc') {
        return a.name.localeCompare(b.name);
      } else {
        return b.name.localeCompare(a.name);
      }
    });
    sortDirection.material = sortDirection.material === 'asc' ? 'desc' : 'asc';
    renderTable();
  }
}

</script>

</body>
</html>
